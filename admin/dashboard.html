<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo - Computa√ß√£o em Nuvem</title>
  <link rel="stylesheet" href="../styles/admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="admin-header">
    <div class="logo">
      <h1><i class="fas fa-cloud"></i> Computa√ß√£o em Nuvem</h1>
    </div>
    <div class="admin-info">
      <span class="admin-name">Administrador</span>
      <button id="btn-logout" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Sair</button>
    </div>
  </header>

  <div class="admin-container">
    <aside class="admin-sidebar">
      <nav class="admin-nav">
        <ul>
          <li class="nav-item active" data-tab="alunos">
            <i class="fas fa-user-graduate"></i> Alunos
          </li>
          <li class="nav-item" data-tab="insignias">
            <i class="fas fa-medal"></i> Ins√≠gnias
          </li>
          <li class="nav-item" data-tab="grupos">
            <i class="fas fa-users"></i> Grupos
          </li>
          <li class="nav-item" data-tab="avaliacao360">
            <i class="fas fa-clipboard-check"></i> Avalia√ß√£o 360
          </li>
          <!-- Removido: Projetos -->
          <li class="nav-item" data-tab="conteudo">
            <i class="fas fa-file-alt"></i> Conte√∫do
          </li>
        </ul>
      </nav>
    </aside>

    <main class="admin-content">
      <!-- Alunos Tab -->
      <section id="alunos-tab" class="admin-tab active">
        <div class="tab-header">
          <h2>Gest√£o de Alunos</h2>
          <button id="add-aluno-btn" class="btn-primary">
            <i class="fas fa-plus"></i> Adicionar Aluno
          </button>
        </div>

        <div class="search-bar">
          <input type="text" id="search-aluno" placeholder="Buscar aluno por nome...">
          <button><i class="fas fa-search"></i></button>
        </div>

        <div class="data-table-container">
          <table id="alunos-table" class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Apelido</th>
                <th>E-mail</th>
                <th>Grupo</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dados ser√£o carregados dinamicamente -->
              <tr>
                <td colspan="6" class="loading-message">
                  <i class="fas fa-spinner fa-spin"></i> Carregando alunos...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modal para adicionar/editar aluno -->
        <div id="aluno-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="aluno-modal-title">Adicionar Aluno</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <form id="aluno-form">
                <input type="hidden" id="aluno-id">
                
                <div class="form-group">
                  <label for="aluno-nome">Nome Completo:</label>
                  <input type="text" id="aluno-nome" required>
                </div>
                
                <div class="form-group">
                  <label for="aluno-alias">Apelido/Alias:</label>
                  <input type="text" id="aluno-alias">
                </div>
                
                <div class="form-group">
                  <label for="aluno-email">E-mail:</label>
                  <input type="email" id="aluno-email" required>
                </div>
                
                <div class="form-group">
                  <label for="aluno-grupo">Grupo:</label>
                  <select id="aluno-grupo">
                    <option value="">Selecione um grupo</option>
                    <!-- Grupos ser√£o carregados dinamicamente -->
                  </select>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn-cancel">Cancelar</button>
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Ins√≠gnias Tab -->
      <section id="insignias-tab" class="admin-tab">
        <div class="tab-header">
          <h2>Gest√£o de Ins√≠gnias</h2>
        </div>

        <div class="search-bar">
          <select id="filtro-bloco">
            <option value="">Todos os Blocos</option>
            <option value="Bloco1">Bloco 1 - Fundamentos</option>
            <option value="Bloco2">Bloco 2 - Armazenamento</option>
            <option value="Bloco3">Bloco 3 - Serverless</option>
            <option value="Bloco4">Bloco 4 - Monitoramento</option>
            <option value="Bloco5">Bloco 5 - Avalia√ß√£o Individual</option>
          </select>
          <input type="text" id="search-aluno-insignia" placeholder="Buscar aluno...">
          <button><i class="fas fa-search"></i></button>
        </div>

        <div class="data-table-container">
          <table id="insignias-table" class="data-table">
            <thead>
              <tr>
                <th>Aluno</th>
                <th>Ins√≠gnia</th>
                <th>Categoria</th>
                <th>Bloco</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dados ser√£o carregados dinamicamente -->
              <tr>
                <td colspan="5" class="loading-message">
                  <i class="fas fa-spinner fa-spin"></i> Carregando ins√≠gnias...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modal para adicionar/editar ins√≠gnia -->
        <div id="insignia-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="insignia-modal-title">Atribuir Ins√≠gnia</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <form id="insignia-form">
                <div class="form-group">
                  <label for="insignia-aluno">Aluno:</label>
                  <select id="insignia-aluno" required>
                    <option value="">Selecione um aluno</option>
                    <!-- Alunos ser√£o carregados dinamicamente -->
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="insignia-bloco">Bloco:</label>
                  <select id="insignia-bloco" required>
                    <option value="">Selecione um bloco</option>
                    <option value="Bloco1">Bloco 1 - Fundamentos</option>
                    <option value="Bloco2">Bloco 2 - Armazenamento</option>
                    <option value="Bloco3">Bloco 3 - Serverless</option>
                    <option value="Bloco4">Bloco 4 - Monitoramento</option>
                    <option value="Bloco5">Bloco 5 - Avalia√ß√£o Individual</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="insignia-tipo">Ins√≠gnia:</label>
                  <select id="insignia-tipo" required>
                    <option value="">Selecione uma ins√≠gnia</option>
                    <!-- Ins√≠gnias ser√£o carregadas dinamicamente com base no bloco -->
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="insignia-categoria">Categoria:</label>
                  <select id="insignia-categoria" required>
                    <option value="">Selecione uma categoria</option>
                    <option value="Diamante">üíé Diamante (100%)</option>
                    <option value="Ouro">üèÖ Ouro (80%)</option>
                    <option value="Prata">ü•à Prata (65%)</option>
                    <option value="Bronze">ü•â Bronze (50%)</option>
                    <option value="Cobre">üü´ Cobre (20%)</option>
                    <option value="0%">üö´ Sem Ins√≠gnia (0%)</option>
                  </select>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn-cancel">Cancelar</button>
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Grupos Tab -->
      <section id="grupos-tab" class="admin-tab">
        <div class="tab-header">
          <h2>Gest√£o de Grupos</h2>
          <button id="add-grupo-btn" class="btn-primary">
            <i class="fas fa-plus"></i> Adicionar Grupo
          </button>
        </div>

        <div class="data-table-container">
          <table id="grupos-table" class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome do Grupo</th>
                <th>Membros</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dados ser√£o carregados dinamicamente -->
              <tr>
                <td colspan="4" class="loading-message">
                  <i class="fas fa-spinner fa-spin"></i> Carregando grupos...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modal para adicionar/editar grupo -->
        <div id="grupo-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="grupo-modal-title">Adicionar Grupo</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <form id="grupo-form">
                <input type="hidden" id="grupo-id">
                
                <div class="form-group">
                  <label for="grupo-nome">Nome do Grupo:</label>
                  <input type="text" id="grupo-nome" required>
                </div>
                
                <div class="form-group">
                  <label>Membros do Grupo:</label>
                  <div id="grupo-membros-list" class="checkbox-list">
                    <!-- Alunos ser√£o carregados dinamicamente -->
                    <div class="loading-message">
                      <i class="fas fa-spinner fa-spin"></i> Carregando alunos...
                    </div>
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn-cancel">Cancelar</button>
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Avalia√ß√£o 360 Tab -->
      <section id="avaliacao360-tab" class="admin-tab">
        <div class="tab-header">
          <h2>Gest√£o de Avalia√ß√£o 360¬∞</h2>
          <button id="add-avaliacao-btn" class="btn-primary">
            <i class="fas fa-plus"></i> Nova Avalia√ß√£o
          </button>
        </div>

        <div class="data-table-container">
          <table id="avaliacoes-table" class="data-table">
            <thead>
              <tr>
                <th>Projeto</th>
                <th>Data de In√≠cio</th>
                <th>Data de T√©rmino</th>
                <th>Status</th>
                <th>Participa√ß√µes</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dados ser√£o carregados dinamicamente -->
              <tr>
                <td colspan="6" class="loading-message">
                  <i class="fas fa-spinner fa-spin"></i> Carregando avalia√ß√µes...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modal para adicionar/editar avalia√ß√£o -->
        <div id="avaliacao-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="avaliacao-modal-title">Nova Avalia√ß√£o 360¬∞</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <form id="avaliacao-form">
                <input type="hidden" id="avaliacao-id">
                
                <div class="form-group">
                  <label for="avaliacao-titulo">T√≠tulo:</label>
                  <input type="text" id="avaliacao-titulo" required>
                </div>
                
                <div class="form-group">
                  <label for="avaliacao-projeto">Projeto:</label>
                  <select id="avaliacao-projeto" required>
                    <option value="">Selecione um projeto</option>
                    <option value="Projeto1">Projeto 1 - Meu #1 Ambiente na Nuvem</option>
                    <option value="Projeto2">Projeto 2 - Armazenamento e Banco de Dados</option>
                    <option value="Projeto3">Projeto 3 - Aplica√ß√µes Serverless</option>
                    <option value="Projeto4">Projeto 4 - Monitoramento e Otimiza√ß√£o</option>
                  </select>
                </div>
                
                <div class="form-group date-group">
                  <label for="avaliacao-data-inicio">Data de In√≠cio:</label>
                  <input type="datetime-local" id="avaliacao-data-inicio" required>
                </div>
                
                <div class="form-group date-group">
                  <label for="avaliacao-data-fim">Data de T√©rmino:</label>
                  <input type="datetime-local" id="avaliacao-data-fim" required>
                </div>
                
                <div class="form-group">
                  <label>Grupos Participantes:</label>
                  <div id="avaliacao-grupos-list" class="checkbox-list">
                    <!-- Grupos ser√£o carregados dinamicamente -->
                    <div class="loading-message">
                      <i class="fas fa-spinner fa-spin"></i> Carregando grupos...
                    </div>
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn-cancel">Cancelar</button>
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>


      <!-- Conte√∫do Tab (Nova se√ß√£o para gerenciar o plano de ensino) -->
      <section id="conteudo-tab" class="admin-tab">
        <div class="tab-header">
          <h2>Gest√£o de Conte√∫do</h2>
        </div>

        <div class="card-container">
          <div class="content-card">
            <div class="content-card-header">
              <h3>Descri√ß√£o do Curso</h3>
            </div>
            <div class="content-card-body">
              <form id="curso-descricao-form">
                <div class="form-group">
                  <label for="curso-descricao-texto">Texto da Descri√ß√£o:</label>
                  <textarea id="curso-descricao-texto" rows="3" required></textarea>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>

          <div class="content-card">
            <div class="content-card-header">
              <h3>Plano de Ensino</h3>
            </div>
            <div class="content-card-body">
              <form id="plano-ensino-form">
                <div class="form-group">
                  <label for="plano-ensino-html">Conte√∫do HTML do Plano de Ensino:</label>
                  <p class="help-text">Use HTML para formatar o conte√∫do. Voc√™ pode usar tags como &lt;h3&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;table&gt;, etc.</p>
                  <textarea id="plano-ensino-html" rows="15" class="code-editor"></textarea>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>

          <div class="content-card">
            <div class="content-card-header">
              <h3>Avisos</h3>
              <button id="add-aviso-btn" class="btn-secondary">
                <i class="fas fa-plus"></i> Novo Aviso
              </button>
            </div>
            <div class="content-card-body">
              <div id="avisos-list" class="list-container">
                <div class="loading-message">
                  <i class="fas fa-spinner fa-spin"></i> Carregando avisos...
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal para adicionar/editar aviso -->
        <div id="aviso-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="aviso-modal-title">Adicionar Aviso</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <form id="aviso-form">
                <input type="hidden" id="aviso-id">
                
                <div class="form-group">
                  <label for="aviso-titulo">T√≠tulo:</label>
                  <input type="text" id="aviso-titulo" required>
                </div>
                
                <div class="form-group">
                  <label for="aviso-conteudo">Conte√∫do:</label>
                  <textarea id="aviso-conteudo" rows="5" required></textarea>
                </div>
                
                <div class="form-group">
                  <label for="aviso-data">Data:</label>
                  <input type="date" id="aviso-data" required>
                </div>
                
                <div class="form-group">
                  <label for="aviso-link">Link (opcional):</label>
                  <input type="url" id="aviso-link" placeholder="https://...">
                </div>
                
                <div class="form-group">
                  <label for="aviso-link-texto">Texto do Link (opcional):</label>
                  <input type="text" id="aviso-link-texto" placeholder="Ex: Ver detalhes">
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn-cancel">Cancelar</button>
                  <button type="submit" class="btn-save">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDH9hUEuMlsbPyq5rO5zldBnNQOX26bbG4",
      authDomain: "comp-nuvem-2025.firebaseapp.com",
      databaseURL: "https://comp-nuvem-2025-default-rtdb.firebaseio.com",
      projectId: "comp-nuvem-2025",
      storageBucket: "comp-nuvem-2025.firebasestorage.app",
      messagingSenderId: "60212118707",
      appId: "1:60212118707:web:714faf88ddfd3b536c9cc6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Check if user is authenticated
    if (!localStorage.getItem('adminAuthenticated')) {
      window.location.href = 'login.html';
    }

    // Logout
    document.getElementById('btn-logout').addEventListener('click', function() {
      localStorage.removeItem('adminAuthenticated');
      window.location.href = 'login.html';
    });

    // Tab switching
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', function() {
        // Remove active class from all tabs
        document.querySelectorAll('.nav-item').forEach(navItem => {
          navItem.classList.remove('active');
        });
        document.querySelectorAll('.admin-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // Add active class to clicked tab
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab') + '-tab';
        document.getElementById(tabId).classList.add('active');
      });
    });

    // Modals
    document.querySelectorAll('.close-modal, .btn-cancel').forEach(button => {
      button.addEventListener('click', function() {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
      });
    });

    // When the user clicks anywhere outside of the modal, close it
    window.addEventListener('click', function(event) {
      document.querySelectorAll('.modal').forEach(modal => {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      });
    });

    // Adicionar eventos para bot√µes de adicionar
    document.getElementById('add-aluno-btn').addEventListener('click', function() {
      document.getElementById('aluno-modal-title').textContent = 'Adicionar Aluno';
      document.getElementById('aluno-form').reset();
      document.getElementById('aluno-modal').style.display = 'block';
    });

    document.getElementById('add-grupo-btn').addEventListener('click', function() {
      document.getElementById('grupo-modal-title').textContent = 'Adicionar Grupo';
      document.getElementById('grupo-form').reset();
      document.getElementById('grupo-modal').style.display = 'block';
    });

    document.getElementById('add-avaliacao-btn').addEventListener('click', function() {
      document.getElementById('avaliacao-modal-title').textContent = 'Nova Avalia√ß√£o 360¬∞';
      document.getElementById('avaliacao-form').reset();
      document.getElementById('avaliacao-modal').style.display = 'block';
    });

    // Initial load
    document.addEventListener('DOMContentLoaded', function() {
      loadAlunos();
      loadGrupos();
      loadInsignias();
      loadAvaliacoes();
      // As fun√ß√µes load para Projetos e Conte√∫do podem ser implementadas conforme necess√°rio
    });

    // Load data (placeholder - to be implemented)
    function loadAlunos() {
      // Implementation will be added
    }

    function loadGrupos() {
      // Implementation will be added
    }

    function loadInsignias() {
      // Implementation will be added
    }

    function loadAvaliacoes() {
      // Implementation will be added
    }

      // Carregar, exibir e gerenciar projetos
    function loadProjetos() {
      const projetosTable = document.getElementById('projetos-table').getElementsByTagName('tbody')[0];
      
      // Mostrar mensagem de carregamento
      projetosTable.innerHTML = `
        <tr>
          <td colspan="6" class="loading-message">
            <i class="fas fa-spinner fa-spin"></i> Carregando projetos...
          </td>
        </tr>
      `;
      
      // Buscar projetos do Firebase
      database.ref('projetos').orderByChild('ordem').once('value')
        .then(snapshot => {
          const projetos = snapshot.val();
          
          if (!projetos) {
            projetosTable.innerHTML = `
              <tr>
                <td colspan="6" class="empty-message">
                  Nenhum projeto cadastrado. Clique em "Adicionar Projeto" para criar um novo.
                </td>
              </tr>
            `;
            return;
          }
          
          // Limpar tabela
          projetosTable.innerHTML = '';
          
          // Adicionar cada projeto √† tabela
          Object.entries(projetos).forEach(([id, projeto]) => {
            const row = projetosTable.insertRow();
            
            // ID
            const cellId = row.insertCell();
            cellId.textContent = id.substring(0, 8) + '...';
            cellId.title = id;
            
            // T√≠tulo
            const cellTitulo = row.insertCell();
            cellTitulo.textContent = projeto.titulo || 'Sem t√≠tulo';
            
            // Status
            const cellStatus = row.insertCell();
            if (projeto.status) {
              const statusSpan = document.createElement('span');
              statusSpan.className = `status-badge ${getStatusClass(projeto.status)}`;
              statusSpan.textContent = projeto.status;
              cellStatus.appendChild(statusSpan);
            } else {
              cellStatus.textContent = 'N√£o definido';
            }
            
            // Data de Entrega
            const cellData = row.insertCell();
            cellData.textContent = projeto.dataEntrega ? formatDate(projeto.dataEntrega) : 'N√£o definida';
            
            // Ordem
            const cellOrdem = row.insertCell();
            cellOrdem.textContent = projeto.ordem || '-';
            
            // A√ß√µes
            const cellAcoes = row.insertCell();
            cellAcoes.className = 'action-buttons';
            
            // Bot√£o Editar
            const btnEditar = document.createElement('button');
            btnEditar.className = 'btn-edit';
            btnEditar.innerHTML = '<i class="fas fa-edit"></i>';
            btnEditar.title = 'Editar';
            btnEditar.addEventListener('click', () => editarProjeto(id, projeto));
            cellAcoes.appendChild(btnEditar);
            
            // Bot√£o Conte√∫do
            const btnConteudo = document.createElement('button');
            btnConteudo.className = 'btn-view';
            btnConteudo.innerHTML = '<i class="fas fa-file-alt"></i>';
            btnConteudo.title = 'Editar Conte√∫do';
            btnConteudo.addEventListener('click', () => editarConteudoProjeto(id, projeto));
            cellAcoes.appendChild(btnConteudo);
            
            // Bot√£o Excluir
            const btnExcluir = document.createElement('button');
            btnExcluir.className = 'btn-delete';
            btnExcluir.innerHTML = '<i class="fas fa-trash"></i>';
            btnExcluir.title = 'Excluir';
            btnExcluir.addEventListener('click', () => excluirProjeto(id, projeto.titulo));
            cellAcoes.appendChild(btnExcluir);
          });
        })
        .catch(error => {
          console.error('Erro ao carregar projetos:', error);
          projetosTable.innerHTML = `
            <tr>
              <td colspan="6" class="error-message">
                Erro ao carregar projetos: ${error.message}
              </td>
            </tr>
          `;
        });
    }

    // Abrir modal para adicionar novo projeto
    function adicionarProjeto() {
      document.getElementById('projeto-modal-title').textContent = 'Adicionar Projeto';
      document.getElementById('projeto-form').reset();
      document.getElementById('projeto-id').value = '';
      document.getElementById('btn-editar-conteudo').style.display = 'none';
      document.getElementById('projeto-modal').style.display = 'block';
    }

    // Abrir modal para editar projeto existente
    function editarProjeto(id, projeto) {
      document.getElementById('projeto-modal-title').textContent = 'Editar Projeto';
      document.getElementById('projeto-id').value = id;
      document.getElementById('projeto-titulo').value = projeto.titulo || '';
      document.getElementById('projeto-descricao').value = projeto.descricao || '';
      document.getElementById('projeto-status').value = projeto.status || 'Aberto';
      document.getElementById('projeto-data-entrega').value = projeto.dataEntrega || '';
      document.getElementById('projeto-equipes').value = projeto.equipes || '';
      document.getElementById('projeto-insignias').value = projeto.insignias || '';
      document.getElementById('projeto-ordem').value = projeto.ordem || 1;
      document.getElementById('btn-editar-conteudo').style.display = 'inline-block';
      document.getElementById('projeto-modal').style.display = 'block';
    }

    // Salvar projeto (novo ou editado)
    function salvarProjeto(event) {
      event.preventDefault();
      
      // Obter valores do formul√°rio
      const id = document.getElementById('projeto-id').value;
      const projeto = {
        titulo: document.getElementById('projeto-titulo').value,
        descricao: document.getElementById('projeto-descricao').value,
        status: document.getElementById('projeto-status').value,
        dataEntrega: document.getElementById('projeto-data-entrega').value,
        equipes: document.getElementById('projeto-equipes').value,
        insignias: document.getElementById('projeto-insignias').value,
        ordem: parseInt(document.getElementById('projeto-ordem').value) || 1,
        ultimaAtualizacao: new Date().toISOString()
      };
      
      // Refer√™ncia para salvar no Firebase
      let projetoRef;
      let isNew = false;
      
      if (id) {
        // Atualizar projeto existente
        projetoRef = database.ref(`projetos/${id}`);
      } else {
        // Adicionar novo projeto
        projetoRef = database.ref('projetos').push();
        isNew = true;
      }
      
      // Salvar no Firebase
      projetoRef.update(projeto)
        .then(() => {
          document.getElementById('projeto-modal').style.display = 'none';
          
          // Recarregar lista de projetos
          loadProjetos();
          
          // Se for um novo projeto, abrir modal de conte√∫do
          if (isNew) {
            editarConteudoProjeto(projetoRef.key, projeto);
          }
        })
        .catch(error => {
          console.error('Erro ao salvar projeto:', error);
          alert(`Erro ao salvar projeto: ${error.message}`);
        });
    }

    // Abrir modal para editar conte√∫do completo do projeto
    function editarConteudoProjeto(id, projeto) {
      document.getElementById('conteudo-modal-title').textContent = `Editar Conte√∫do: ${projeto.titulo || 'Sem t√≠tulo'}`;
      document.getElementById('conteudo-projeto-id').value = id;
      
      // Buscar conte√∫do atual do projeto
      database.ref(`projetos/${id}`).once('value')
        .then(snapshot => {
          const projetoCompleto = snapshot.val();
          
          // Preencher o editor de conte√∫do HTML
          document.getElementById('conteudo-projeto-html').value = projetoCompleto.conteudoHtml || generateDefaultContent(projetoCompleto);
          
          // Limpar e preencher o container de FAQ
          const faqContainer = document.getElementById('faq-container');
          faqContainer.innerHTML = '';
          
          if (projetoCompleto.faq && Array.isArray(projetoCompleto.faq)) {
            projetoCompleto.faq.forEach((item, index) => {
              adicionarFaqItem(item.pergunta || '', item.resposta || '');
            });
          } else {
            // Adicionar pelo menos um item de FAQ vazio
            adicionarFaqItem('', '');
          }
          
          // Mostrar o modal
          document.getElementById('conteudo-projeto-modal').style.display = 'block';
        })
        .catch(error => {
          console.error('Erro ao carregar conte√∫do do projeto:', error);
          alert(`Erro ao carregar conte√∫do do projeto: ${error.message}`);
        });
    }

    // Gerar conte√∫do HTML padr√£o para um novo projeto
    function generateDefaultContent(projeto) {
      return `<section class="projeto-descricao">
      <h2>Descri√ß√£o do Projeto</h2>
      <p>${projeto.descricao || 'Adicione aqui uma descri√ß√£o detalhada do projeto.'}</p>
    </section>

    <section class="projeto-objetivos">
      <h2>Objetivos</h2>
      <ul>
        <li>Objetivo 1</li>
        <li>Objetivo 2</li>
        <li>Objetivo 3</li>
      </ul>
    </section>

    <section class="projeto-requisitos">
      <h2>Requisitos</h2>
      <p>Descreva aqui os requisitos do projeto.</p>
    </section>

    <section class="projeto-entregaveis">
      <h2>Entreg√°veis</h2>
      <ul>
        <li>Entreg√°vel 1</li>
        <li>Entreg√°vel 2</li>
        <li>Entreg√°vel 3</li>
      </ul>
    </section>

    <section class="projeto-avaliacao">
      <h2>Crit√©rios de Avalia√ß√£o</h2>
      <table>
        <thead>
          <tr>
            <th>Crit√©rio</th>
            <th>Descri√ß√£o</th>
            <th>Peso</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Crit√©rio 1</td>
            <td>Descri√ß√£o do crit√©rio 1</td>
            <td>30%</td>
          </tr>
          <tr>
            <td>Crit√©rio 2</td>
            <td>Descri√ß√£o do crit√©rio 2</td>
            <td>30%</td>
          </tr>
          <tr>
            <td>Crit√©rio 3</td>
            <td>Descri√ß√£o do crit√©rio 3</td>
            <td>40%</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="projeto-recursos">
      <h2>Recursos Recomendados</h2>
      <p>Lista de recursos recomendados para o projeto.</p>
    </section>`;
    }

    // Adicionar item de FAQ ao container
    function adicionarFaqItem(pergunta = '', resposta = '') {
      const faqContainer = document.getElementById('faq-container');
      const itemIndex = faqContainer.children.length;
      
      const faqItem = document.createElement('div');
      faqItem.className = 'faq-item';
      faqItem.innerHTML = `
        <div class="form-group">
          <label for="faq-pergunta-${itemIndex}">Pergunta:</label>
          <input type="text" id="faq-pergunta-${itemIndex}" class="faq-pergunta" value="${pergunta}" required>
        </div>
        <div class="form-group">
          <label for="faq-resposta-${itemIndex}">Resposta:</label>
          <textarea id="faq-resposta-${itemIndex}" class="faq-resposta" rows="3" required>${resposta}</textarea>
        </div>
        <button type="button" class="btn-remove-faq">
          <i class="fas fa-trash"></i> Remover
        </button>
        <hr>
      `;
      
      // Adicionar evento para remover o item
      faqItem.querySelector('.btn-remove-faq').addEventListener('click', function() {
        faqContainer.removeChild(faqItem);
      });
      
      faqContainer.appendChild(faqItem);
    }

    // Salvar conte√∫do completo do projeto
    function salvarConteudoProjeto(event) {
      event.preventDefault();
      
      const id = document.getElementById('conteudo-projeto-id').value;
      const conteudoHtml = document.getElementById('conteudo-projeto-html').value;
      
      // Coletar dados do FAQ
      const faqItems = document.querySelectorAll('.faq-item');
      const faq = Array.from(faqItems).map(item => ({
        pergunta: item.querySelector('.faq-pergunta').value,
        resposta: item.querySelector('.faq-resposta').value
      })).filter(item => item.pergunta.trim() && item.resposta.trim());
      
      // Salvar no Firebase
      database.ref(`projetos/${id}`).update({
        conteudoHtml,
        faq,
        ultimaAtualizacao: new Date().toISOString()
      })
        .then(() => {
          document.getElementById('conteudo-projeto-modal').style.display = 'none';
          alert('Conte√∫do do projeto salvo com sucesso!');
        })
        .catch(error => {
          console.error('Erro ao salvar conte√∫do do projeto:', error);
          alert(`Erro ao salvar conte√∫do do projeto: ${error.message}`);
        });
    }

    // Confirmar e excluir projeto
    function excluirProjeto(id, titulo) {
      if (confirm(`Tem certeza que deseja excluir o projeto "${titulo || id}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        database.ref(`projetos/${id}`).remove()
          .then(() => {
            loadProjetos();
          })
          .catch(error => {
            console.error('Erro ao excluir projeto:', error);
            alert(`Erro ao excluir projeto: ${error.message}`);
          });
      }
    }

    // Carregar, exibir e gerenciar avisos
    function loadAvisos() {
      const avisosContainer = document.getElementById('avisos-list');
      
      // Mostrar mensagem de carregamento
      avisosContainer.innerHTML = `
        <div class="loading-message">
          <i class="fas fa-spinner fa-spin"></i> Carregando avisos...
        </div>
      `;
      
      // Buscar avisos do Firebase
      database.ref('avisos').orderByChild('data').once('value')
        .then(snapshot => {
          const avisos = snapshot.val();
          
          if (!avisos) {
            avisosContainer.innerHTML = `
              <div class="empty-message">
                Nenhum aviso cadastrado. Clique em "Novo Aviso" para criar um.
              </div>
            `;
            return;
          }
          
          // Limpar container
          avisosContainer.innerHTML = '';
          
          // Adicionar cada aviso ao container
          Object.entries(avisos)
            .sort(([, a], [, b]) => new Date(b.data) - new Date(a.data))
            .forEach(([id, aviso]) => {
              const avisoElement = document.createElement('div');
              avisoElement.className = 'list-item';
              avisoElement.innerHTML = `
                <div class="list-item-content">
                  <h4>${aviso.titulo || 'Sem t√≠tulo'}</h4>
                  <div class="list-item-meta">
                    <span>${formatDate(aviso.data)}</span>
                  </div>
                  <p>${aviso.conteudo || ''}</p>
                </div>
                <div class="list-item-actions">
                  <button class="btn-edit" title="Editar"><i class="fas fa-edit"></i></button>
                  <button class="btn-delete" title="Excluir"><i class="fas fa-trash"></i></button>
                </div>
              `;
              
              // Adicionar eventos para os bot√µes
              avisoElement.querySelector('.btn-edit').addEventListener('click', () => editarAviso(id, aviso));
              avisoElement.querySelector('.btn-delete').addEventListener('click', () => excluirAviso(id, aviso.titulo));
              
              avisosContainer.appendChild(avisoElement);
            });
        })
        .catch(error => {
          console.error('Erro ao carregar avisos:', error);
          avisosContainer.innerHTML = `
            <div class="error-message">
              Erro ao carregar avisos: ${error.message}
            </div>
          `;
        });
    }

    // Abrir modal para adicionar novo aviso
    function adicionarAviso() {
      document.getElementById('aviso-modal-title').textContent = 'Adicionar Aviso';
      document.getElementById('aviso-form').reset();
      document.getElementById('aviso-id').value = '';
      
      // Definir data atual como padr√£o
      const dataAtual = new Date().toISOString().split('T')[0];
      document.getElementById('aviso-data').value = dataAtual;
      
      document.getElementById('aviso-modal').style.display = 'block';
    }

    // Abrir modal para editar aviso existente
    function editarAviso(id, aviso) {
      document.getElementById('aviso-modal-title').textContent = 'Editar Aviso';
      document.getElementById('aviso-id').value = id;
      document.getElementById('aviso-titulo').value = aviso.titulo || '';
      document.getElementById('aviso-conteudo').value = aviso.conteudo || '';
      document.getElementById('aviso-data').value = aviso.data || '';
      document.getElementById('aviso-link').value = aviso.link || '';
      document.getElementById('aviso-link-texto').value = aviso.linkTexto || '';
      
      document.getElementById('aviso-modal').style.display = 'block';
    }

    // Salvar aviso (novo ou editado)
    function salvarAviso(event) {
      event.preventDefault();
      
      // Obter valores do formul√°rio
      const id = document.getElementById('aviso-id').value;
      const aviso = {
        titulo: document.getElementById('aviso-titulo').value,
        conteudo: document.getElementById('aviso-conteudo').value,
        data: document.getElementById('aviso-data').value,
        link: document.getElementById('aviso-link').value,
        linkTexto: document.getElementById('aviso-link-texto').value,
        ultimaAtualizacao: new Date().toISOString()
      };
      
      // Refer√™ncia para salvar no Firebase
      const avisoRef = id ? database.ref(`avisos/${id}`) : database.ref('avisos').push();
      
      // Salvar no Firebase
      avisoRef.update(aviso)
        .then(() => {
          document.getElementById('aviso-modal').style.display = 'none';
          
          // Recarregar avisos
          loadAvisos();
        })
        .catch(error => {
          console.error('Erro ao salvar aviso:', error);
          alert(`Erro ao salvar aviso: ${error.message}`);
        });
    }

    // Confirmar e excluir aviso
    function excluirAviso(id, titulo) {
      if (confirm(`Tem certeza que deseja excluir o aviso "${titulo || id}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
        database.ref(`avisos/${id}`).remove()
          .then(() => {
            loadAvisos();
          })
          .catch(error => {
            console.error('Erro ao excluir aviso:', error);
            alert(`Erro ao excluir aviso: ${error.message}`);
          });
      }
    }

    // Carregar conte√∫do do curso
    function loadConteudoCurso() {
      // Carregar descri√ß√£o do curso
      database.ref('conteudo/descricao').once('value')
        .then(snapshot => {
          const data = snapshot.val();
          document.getElementById('curso-descricao-texto').value = data && data.texto ? data.texto : '';
        })
        .catch(error => {
          console.error('Erro ao carregar descri√ß√£o do curso:', error);
        });
      
      // Carregar plano de ensino
      database.ref('conteudo/planoEnsino').once('value')
        .then(snapshot => {
          const data = snapshot.val();
          document.getElementById('plano-ensino-html').value = data && data.html ? data.html : '';
        })
        .catch(error => {
          console.error('Erro ao carregar plano de ensino:', error);
        });
    }

    // Salvar descri√ß√£o do curso
    function salvarDescricaoCurso(event) {
      event.preventDefault();
      
      const texto = document.getElementById('curso-descricao-texto').value;
      
      database.ref('conteudo/descricao').update({
        texto,
        ultimaAtualizacao: new Date().toISOString()
      })
        .then(() => {
          alert('Descri√ß√£o do curso salva com sucesso!');
        })
        .catch(error => {
          console.error('Erro ao salvar descri√ß√£o do curso:', error);
          alert(`Erro ao salvar descri√ß√£o do curso: ${error.message}`);
        });
    }

    // Salvar plano de ensino
    function salvarPlanoEnsino(event) {
      event.preventDefault();
      
      const html = document.getElementById('plano-ensino-html').value;
      
      database.ref('conteudo/planoEnsino').update({
        html,
        ultimaAtualizacao: new Date().toISOString()
      })
        .then(() => {
          alert('Plano de ensino salvo com sucesso!');
        })
        .catch(error => {
          console.error('Erro ao salvar plano de ensino:', error);
          alert(`Erro ao salvar plano de ensino: ${error.message}`);
        });
    }

    // Formatar data para exibi√ß√£o
    function formatDate(dateString) {
      if (!dateString) return 'Data n√£o definida';
      
      const date = new Date(dateString);
      return date.toLocaleDateString('pt-BR');
    }

    // Obter classe CSS com base no status do projeto
    function getStatusClass(status) {
      if (!status) return '';
      
      const statusLower = status.toLowerCase();
      if (statusLower.includes('aberto')) return 'status-active';
      if (statusLower.includes('ativo')) return 'status-active';
      if (statusLower.includes('conclu√≠do')) return 'status-completed';
      if (statusLower.includes('encerrado')) return 'status-expired';
      return '';
    }

    // Adicionar event listeners quando o DOM estiver carregado
    document.addEventListener('DOMContentLoaded', function() {
      // Adicionar novo projeto
      document.getElementById('add-projeto-btn').addEventListener('click', adicionarProjeto);
      
      // Salvar projeto
      document.getElementById('projeto-form').addEventListener('submit', salvarProjeto);
      
      // Bot√£o para editar conte√∫do
      document.getElementById('btn-editar-conteudo').addEventListener('click', function() {
        const id = document.getElementById('projeto-id').value;
        const titulo = document.getElementById('projeto-titulo').value;
        
        document.getElementById('projeto-modal').style.display = 'none';
        
        editarConteudoProjeto(id, { titulo });
      });
      
      // Adicionar FAQ item
      document.getElementById('add-faq-btn').addEventListener('click', function() {
        adicionarFaqItem();
      });
      
      // Salvar conte√∫do do projeto
      document.getElementById('conteudo-projeto-form').addEventListener('submit', salvarConteudoProjeto);
      
      // Adicionar novo aviso
      document.getElementById('add-aviso-btn').addEventListener('click', adicionarAviso);
      
      // Salvar aviso
      document.getElementById('aviso-form').addEventListener('submit', salvarAviso);
      
      // Salvar descri√ß√£o do curso
      document.getElementById('curso-descricao-form').addEventListener('submit', salvarDescricaoCurso);
      
      // Salvar plano de ensino
      document.getElementById('plano-ensino-form').addEventListener('submit', salvarPlanoEnsino);
      
      // Carregar dados iniciais
      loadProjetos();
      loadAvisos();
      loadConteudoCurso();
    });

      </script>
    </body>
    </html>
